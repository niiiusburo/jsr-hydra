ai.jsralgo.com {
	# WebSocket routes – disable buffering and extend timeouts for long-lived connections
	handle /ws/* {
		reverse_proxy jsr-backend:8000 {
			flush_interval -1
			transport http {
				read_timeout 3600s
				write_timeout 3600s
			}
		}
	}

	handle /api/* {
		reverse_proxy jsr-backend:8000
	}

	handle {
		reverse_proxy jsr-frontend:3000
	}

	header X-Content-Type-Options nosniff
	header X-Frame-Options DENY
	header Referrer-Policy no-referrer
}

# Fallback for direct IP access.
# Keep this HTTP-only so users can still reach the app via server IP
# without hitting TLS certificate errors for non-domain hosts.
http://:80 {
	# WebSocket routes – disable buffering and extend timeouts for long-lived connections
	handle /ws/* {
		reverse_proxy jsr-backend:8000 {
			flush_interval -1
			transport http {
				read_timeout 3600s
				write_timeout 3600s
			}
		}
	}

	handle /api/* {
		reverse_proxy jsr-backend:8000
	}

	handle {
		reverse_proxy jsr-frontend:3000
	}

	header X-Content-Type-Options nosniff
	header X-Frame-Options DENY
	header Referrer-Policy no-referrer
}
